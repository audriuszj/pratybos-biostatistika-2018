gitbook.require(["gitbook","lodash","jQuery"],function(gitbook,_,$){var gs=gitbook.storage;gitbook.events.bind("start",function(e,config){var edit=config.edit;edit&&edit.link&&gitbook.toolbar.createButton({icon:"fa fa-edit",label:edit.text||"Edit",position:"left",onClick:function(e){e.preventDefault(),window.open(edit.link)}});var down=config.download,normalizeDownload=function(){return down&&down instanceof Array&&0!==down.length?down[0]instanceof Array?down:$.map(down,function(file){return[[file,file.replace(/.*[.]/g,"").toUpperCase()]]}):void 0};down=normalizeDownload(down),down&&gitbook.toolbar.createButton(1===down.length&&/[.]pdf$/.test(down[0][0])?{icon:"fa fa-file-pdf-o",label:down[0][1],position:"left",onClick:function(e){e.preventDefault(),window.open(down[0][0])}}:{icon:"fa fa-download",label:"Download",position:"left",dropdown:$.map(down,function(item){return{text:item[1],onClick:function(e){e.preventDefault(),window.open(item[0])}}})});var href=window.location.pathname;href=href.substr(href.lastIndexOf("/")+1),""===href&&(href="index.html");var li=$('a[href^="'+href+location.hash+'"]').parent("li.chapter").first(),summary=$("ul.summary"),chaps=summary.find("li.chapter");0===li.length&&(li=chaps.first()),li.addClass("active"),chaps.on("click",function(){chaps.removeClass("active"),$(this).addClass("active"),gs.set("tocScrollTop",summary.scrollTop())});var toc=config.toc;toc&&toc.collapse&&function(){var type=toc.collapse;if("none"!==type&&("section"===type||"subsection"===type)){var toc_sub=summary.children("li[data-level]").children("ul");"section"===type?toc_sub.hide().parent().has(li).children("ul").show():toc_sub.children("li").children("ul").hide().parent().has(li).children("ul").show(),li.children("ul").show();var toc_sub2=toc_sub.children("li");"section"===type&&toc_sub2.children("ul").hide(),summary.children("li[data-level]").find("a").on("click.bookdown",function(){href===$(this).attr("href").replace(/#.*/,"")&&$(this).parent("li").children("ul").toggle()})}}(),$("a").each(function(i,el){el.offsetWidth>=el.scrollWidth||"undefined"!=typeof el.title&&(el.title=el.text)});var pos=gs.get("tocScrollTop");"undefined"!=typeof pos&&summary.scrollTop(pos),toc&&toc.scroll_highlight!==!1&&function(){var ht=$(window).height(),rect=li[0].getBoundingClientRect();(rect.top>=ht||rect.top<=0||rect.bottom<=0)&&summary.scrollTop(li[0].offsetTop);var items=$('a[href^="'+href+'"]').parent("li.chapter"),m=items.length;if(0===m&&(items=summary.find("li.chapter"),m=items.length),0!==m){var hs=bookInner.find(".page-inner").find("h1,h2,h3"),n=hs.length,ts=hs.map(function(i,el){return $(el).text()});if(0!==n){var scrollHandler=function(){var ht=$(window).height();clearTimeout($.data(this,"scrollTimer")),$.data(this,"scrollTimer",setTimeout(function(){for(var i=0;n>i;i++){var rect=hs[i].getBoundingClientRect();if(rect.top>=0&&rect.bottom<=ht)break}if(i!==n){items.removeClass("active");for(var j=0;m>j&&items.eq(j).children("a").first().text()!==ts[i];j++);for(j===m&&(j=0);j>0&&items.eq(j).is(":hidden");)j--;items.eq(j).addClass("active")}},250))};bookInner.on("scroll.bookdown",scrollHandler),bookBody.on("scroll.bookdown",scrollHandler)}}}(),$('a[href="'+href+'"]').parent("li.chapter").children("a").on("click",function(){return bookInner.scrollTop(0),bookBody.scrollTop(0),!1});var toolbar=config.toolbar;if(!toolbar||"static"!==toolbar.position){var bookHeader=$(".book-header");bookBody.addClass("fixed"),bookHeader.addClass("fixed").css("background-color",bookBody.css("background-color")).on("click.bookdown",function(){bookHeader.css("background-color",bookBody.css("background-color"))})}}),gitbook.events.bind("page.change",function(){var summary=$("ul.summary");gs.set("tocScrollTop",summary.scrollTop())});var bookBody=$(".book-body"),bookInner=bookBody.find(".body-inner"),chapterTitle=function(){return bookInner.find(".page-inner").find("h1,h2").first().text()},bookTitle=function(){return bookInner.find(".book-header > h1").first().text()},saveScrollPos=function(){gs.set("bodyScrollTop",{body:bookBody.scrollTop(),inner:bookInner.scrollTop(),focused:document.hasFocus(),title:chapterTitle()})};$(document).on("servr:reload",saveScrollPos);var inIFrame=function(){var inIframe=!0;try{inIframe=window.self!==window.top}catch(e){}return inIframe};$(window).on("blur unload",function(e){inIFrame()&&saveScrollPos(e),gs.set("bookTitle",bookTitle())}),$(function(){gs.get("bookTitle","")!==bookTitle()&&localStorage.clear();var pos=gs.get("bodyScrollTop");pos&&(pos.title===chapterTitle()&&(0!==pos.body&&bookBody.scrollTop(pos.body),0!==pos.inner&&bookInner.scrollTop(pos.inner)),pos.focused&&bookInner.find(".page-wrapper").focus()),gs.remove("bodyScrollTop")})});
